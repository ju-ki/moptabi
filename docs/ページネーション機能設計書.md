# ページネーション・検索・ソート機能 設計書

## 概要

管理画面のユーザーリストとお知らせ一覧にページネーション、検索、ソート機能を追加します。

## 対象機能

### 1. ユーザーリスト (`/admin` - users タブ)

#### 検索機能
| 検索項目 | 検索方法 | 備考 |
|----------|----------|------|
| ユーザー名 | 部分一致（OR検索） | firstName, lastName の結合で検索 |
| メールアドレス | 部分一致 | Clerk API 側でフィルタリング |
| ユーザーID | 部分一致 | |

#### ソート機能
| ソート項目 | デフォルト | 順序 |
|-----------|-----------|------|
| 最終ログイン日時 | ✓ | 降順（新しい順）/ 昇順（古い順） |
| 登録日時 | | 降順 / 昇順 |
| プラン数 | | 降順 / 昇順 |
| 行きたいリスト数 | | 降順 / 昇順 |

#### ページネーション
| 項目 | 値 |
|------|-----|
| 1ページあたりの件数 | 20件 |
| 表示形式 | ページ番号ナビゲーション |

### 2. お知らせ一覧 (`/admin` - notifications タブ)

#### 検索/フィルター機能（AND検索）
| フィルター項目 | フィルター方法 | 備考 |
|----------------|----------------|------|
| タイトル | 部分一致 | |
| お知らせタイプ | 完全一致 | SYSTEM / INFO |
| 公開日 | 日付範囲指定 | from ~ to |

#### ソート機能
| ソート項目 | デフォルト | 順序 |
|-----------|-----------|------|
| 公開日時 | ✓ | 降順（新しい順）/ 昇順（古い順） |
| 作成日時 | | 降順 / 昇順 |
| 既読率 | | 降順 / 昇順 |

#### ページネーション
| 項目 | 値 |
|------|-----|
| 1ページあたりの件数 | 20件 |
| 表示形式 | ページ番号ナビゲーション |

---

## API設計

### ユーザーリスト API

**エンドポイント**: `GET /api/auth/list`

**クエリパラメータ**:
```typescript
interface UserListParams {
  // ページネーション
  page?: number;         // ページ番号（1始まり）、デフォルト: 1
  limit?: number;        // 1ページあたりの件数、デフォルト: 20
  
  // 検索
  search?: string;       // 検索キーワード（名前、メール、IDで検索）
  
  // ソート
  sortBy?: 'lastLoginAt' | 'registeredAt' | 'planCount' | 'wishlistCount';
  sortOrder?: 'asc' | 'desc';  // デフォルト: desc
}
```

**レスポンス**:
```typescript
interface UserListResponse {
  users: User[];
  pagination: {
    currentPage: number;
    totalPages: number;
    totalCount: number;
    limit: number;
    hasNextPage: boolean;
    hasPrevPage: boolean;
  };
}
```

### お知らせ一覧 API（管理者向け）

**エンドポイント**: `GET /api/notification/admin`

**クエリパラメータ**:
```typescript
interface NotificationAdminParams {
  // ページネーション
  page?: number;         // ページ番号（1始まり）、デフォルト: 1
  limit?: number;        // 1ページあたりの件数、デフォルト: 20
  
  // 検索/フィルター（AND検索）
  title?: string;        // タイトル部分一致
  type?: 'SYSTEM' | 'INFO';  // お知らせタイプ
  publishedFrom?: string;    // 公開日（開始）ISO8601形式
  publishedTo?: string;      // 公開日（終了）ISO8601形式
  
  // ソート
  sortBy?: 'publishedAt' | 'createdAt' | 'readRate';
  sortOrder?: 'asc' | 'desc';  // デフォルト: desc
}
```

**レスポンス**:
```typescript
interface NotificationAdminListResponse {
  notifications: NotificationAdmin[];
  pagination: {
    currentPage: number;
    totalPages: number;
    totalCount: number;
    limit: number;
    hasNextPage: boolean;
    hasPrevPage: boolean;
  };
}
```

---

## UI設計

### 共通コンポーネント

#### Paginationコンポーネント
- 前のページ / 次のページ ボタン
- ページ番号表示（1, 2, 3 ... n）
- 総件数表示
- 現在のページ / 総ページ数表示

#### SearchInput コンポーネント
- 検索アイコン付き入力フィールド
- デバウンス処理（300ms）
- クリアボタン

#### SortSelect コンポーネント
- ソート項目選択ドロップダウン
- 昇順/降順トグル

### ユーザーリスト画面

```
┌─────────────────────────────────────────────────────────┐
│ ユーザー一覧                              [検索: ____] │
├─────────────────────────────────────────────────────────┤
│ ソート: [最終ログイン ▼] [降順 ▼]                      │
├─────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────┐│
│ │ テーブルヘッダー                                    ││
│ │ ID | 名前 | メール | 登録日時 | 最終ログイン | ... ││
│ ├─────────────────────────────────────────────────────┤│
│ │ ユーザーデータ行 × 20件                            ││
│ └─────────────────────────────────────────────────────┘│
├─────────────────────────────────────────────────────────┤
│ [<] 1 2 3 ... 10 [>]              全100件中 1-20件表示 │
└─────────────────────────────────────────────────────────┘
```

### お知らせ一覧画面

```
┌─────────────────────────────────────────────────────────┐
│ お知らせ管理                                [+ 新規作成]│
├─────────────────────────────────────────────────────────┤
│ フィルター:                                             │
│ タイトル: [________] タイプ: [全て ▼]                  │
│ 公開日: [____] ～ [____]                               │
│ ソート: [公開日時 ▼] [降順 ▼]                         │
├─────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────┐│
│ │ お知らせカード × 20件                               ││
│ │ - タイトル、タイプ、公開日、既読率、アクション     ││
│ └─────────────────────────────────────────────────────┘│
├─────────────────────────────────────────────────────────┤
│ [<] 1 2 3 ... 5 [>]               全100件中 1-20件表示 │
└─────────────────────────────────────────────────────────┘
```

---

## 実装計画（TDD形式）

### Phase 1: バックエンド実装

1. **スキーマ定義** (`models/`)
   - ページネーションレスポンススキーマ
   - クエリパラメータスキーマ

2. **テストコード作成** (`tests/`)
   - ユーザーリストAPI のテスト
   - お知らせ一覧API のテスト

3. **サービス層実装** (`services/`)
   - ページネーション、検索、ソートロジック

4. **ルート定義更新** (`routes/`)
   - クエリパラメータの追加

5. **コントローラー更新** (`controllers/`)
   - パラメータ取得とサービス呼び出し

### Phase 2: フロントエンド実装

1. **テストコード作成** (`tests/`)
   - Pagination コンポーネントのテスト
   - 検索・フィルター機能のテスト
   - ソート機能のテスト

2. **共通コンポーネント作成**
   - Pagination コンポーネント
   - SearchInput コンポーネント

3. **ページコンポーネント更新**
   - UserList コンポーネント
   - NotificationManagement コンポーネント

4. **フック作成/更新**
   - useAdminData の更新（パラメータ対応）

---

## 技術的考慮事項

### パフォーマンス

1. **デバウンス処理**
   - 検索入力は300msのデバウンスを適用
   - API呼び出し頻度を抑制

2. **URLパラメータとの同期**
   - ページ番号、検索条件をURLに反映
   - ブラウザバック対応
   - 共有可能なURL

3. **キャッシュ戦略**
   - SWRのキャッシュを活用
   - パラメータ変更時は新規フェッチ

### ユーザー体験

1. **ローディング状態**
   - スケルトン表示
   - 検索中のインジケーター

2. **空状態の表示**
   - 検索結果が0件の場合のメッセージ
   - フィルターのリセットボタン

3. **エラーハンドリング**
   - API エラー時のフィードバック
   - リトライボタン
